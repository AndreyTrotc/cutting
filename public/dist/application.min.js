"use strict";var ApplicationConfiguration=function(){var applicationModuleName="citting",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("articles"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("customers"),ApplicationConfiguration.registerModule("prices"),ApplicationConfiguration.registerModule("stores"),ApplicationConfiguration.registerModule("users"),angular.module("articles").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Articles","articles","dropdown","/articles(/create)?"),Menus.addSubMenuItem("topbar","articles","List Articles","articles"),Menus.addSubMenuItem("topbar","articles","New Article","articles/create")}]),angular.module("articles").config(["$stateProvider",function($stateProvider){$stateProvider.state("listArticles",{url:"/articles",templateUrl:"modules/articles/views/list-articles.client.view.html"}).state("createArticle",{url:"/articles/create",templateUrl:"modules/articles/views/create-article.client.view.html"}).state("viewArticle",{url:"/articles/:articleId",templateUrl:"modules/articles/views/view-article.client.view.html"}).state("editArticle",{url:"/articles/:articleId/edit",templateUrl:"modules/articles/views/edit-article.client.view.html"})}]),angular.module("articles").controller("ArticlesController",["$scope","$resource","$stateParams","$location","Authentication","Articles","Stores","Customers","Prices",function($scope,$resource,$stateParams,$location,Authentication,Articles,Stores,Customers,Prices){$scope.authentication=Authentication,$scope.stateParams=$stateParams,$scope.create=function(){var amountRowsArticle=$scope.countArt,tableArt=document.getElementById("table-art"),arr=[];$scope.calculate();for(var j=amountRowsArticle;j>0;j--)$scope.thicknessCreate=tableArt.rows[j].cells[0].childNodes[1].childNodes[1].childNodes[1].value,$scope.widthListCreate=tableArt.rows[j].cells[1].childNodes[1].childNodes[1].childNodes[1].value,$scope.lengthListCreate=tableArt.rows[j].cells[2].childNodes[1].childNodes[1].childNodes[1].value,$scope.formListCreate=tableArt.rows[j].cells[3].childNodes[1].childNodes[1].childNodes[1].childNodes[1].checked,$scope.meterCut=tableArt.rows[j].cells[4].childNodes[1].childNodes[1].childNodes[1].value,$scope.pierceAmount=tableArt.rows[j].cells[5].childNodes[1].childNodes[1].childNodes[1].value,$scope.priseCut=tableArt.rows[j].cells[6].childNodes[1].childNodes[1].childNodes[1].value,$scope.weighMetal=tableArt.rows[j].cells[7].childNodes[1].childNodes[1].childNodes[1].value,$scope.priseStoreMetalKg=10,$scope.priseSaleMetalKg=tableArt.rows[j].cells[9].childNodes[1].childNodes[1].childNodes[1].value,$scope.priseSaleMetal=tableArt.rows[j].cells[10].childNodes[1].childNodes[1].childNodes[1].value,$scope.amountSheet=tableArt.rows[j].cells[11].childNodes[1].childNodes[1].childNodes[1].value,$scope.NamePr=tableArt.rows[j].cells[12].childNodes[1].childNodes[1].childNodes[1].value,$scope.sheetCut=tableArt.rows[j].cells[13].childNodes[1].childNodes[1].childNodes[1].childNodes[1].checked,arr.unshift({thicknessCreate:$scope.thicknessCreate,widthListCreate:$scope.widthListCreate,lengthListCreate:$scope.lengthListCreate,formListCreate:$scope.formListCreate,meterCut:$scope.meterCut,pierceAmount:$scope.pierceAmount,priseCut:$scope.priseCut,weighMetal:$scope.weighMetal,priseStoreMetalKg:$scope.priseStoreMetalKg,priseSaleMetalKg:$scope.priseSaleMetalKg,priseSaleMetal:$scope.priseSaleMetal,amountSheet:$scope.amountSheet,NamePr:$scope.NamePr,sheetCut:$scope.sheetCut});var article=new Articles({NameCustomerCreate:this.NameCustomerCreate,contentArticle:this.contentArticle,formSale:this.formSale,prodSheepment:this.prodSheepment,restSheepment:this.restSheepment,invoiseCompl:this.invoiseCompl,invoisePaid:this.invoisePaid,NameAcceptanceOrder:this.NameAcceptanceOrder,discount:this.discount,sheet:arr,arrResFullPrice:$scope.calculate()});article.$save(function(response){$location.path("/articles"),$scope.NameCustomerCreate="",$scope.thicknessCreate=0,$scope.widthListCreate=0,$scope.lengthListCreate=0,$scope.priseCut=0,$scope.priseSaleMetal=0,$scope.amountSheet=0,$scope.formListCreate=!1,$scope.meterCut=0,$scope.pierceAmount=0,$scope.weighMetal=0,$scope.priseSaleMetalKg=0,$scope.formSale=!1,$scope.NamePr="",$scope.NameAcceptanceOrder="",$scope.sheetCut=!1,$scope.prodSheepment=!1,$scope.restSheepment=!1,$scope.invoiseCompl=!1,$scope.invoisePaid=!1,$scope.arrResFullPrice=[],arr=[]},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.AddNewSheedToArticle=function(){var store=new Stores;store.$save(),$scope.store=store},$scope.remove=function(article){if(article){article.$remove();for(var i in $scope.articles)$scope.articles[i]===article&&($scope.articles.splice(i,1),$scope.find())}else $scope.article.$remove(function(){$location.path("articles")})},$scope.update=function(){var article=$scope.article;document.getElementById("table-art");article.arrResFullPrice=$scope.calculate(),article.$update(function(){$location.path("articles")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.updateList=function(article){article.$update(function(){},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.storeArticles=document.getElementById("arhive-articles").checked,$scope.NameCustomerSelect=document.getElementById("name-customer-create").value,$scope.beforeDate=document.getElementById("before-date").value,$scope.afterDate=document.getElementById("after-date").value,$scope.sortPriceCut=document.getElementById("sort-cut").checked,$scope.sortPriceMettal=document.getElementById("sort-metal").checked,$scope.sortCreated=document.getElementById("sort-created").checked,$scope.select="-created",$scope.sortCreated&&($scope.select="-created"),$scope.sortPriceCut&&($scope.select="-arrResFullPrice[1].totallPriseCut"),$scope.sortPriceMettal&&($scope.select="-arrResFullPrice[1].totallPriseMetal"),$scope.customers=Customers.query(),$scope.articles=Articles.query({arhive:$scope.storeArticles,NameCustomerSelect:$scope.NameCustomerSelect,CustomerBeforeDate:$scope.beforeDate,CustomerAfterDate:$scope.afterDate}),$scope.Sum=0,$scope.SumMetal=0,$scope.SumCut=0,$scope.SumProfitMetal=0,$scope.articles.$promise.then(function(articles){$scope.page=[],$scope.currentPage=1,$scope.numPerPage=30,$scope.maxSize=10;for(var i=articles.length-1;i>=0;i--)$scope.Sum=$scope.Sum+Math.round(100*articles[i].arrResFullPrice[1].totallPrise)/100,$scope.SumCut=$scope.SumCut+Math.round(100*articles[i].arrResFullPrice[1].totallPriseCut)/100,$scope.SumMetal=$scope.SumMetal+Math.round(100*articles[i].arrResFullPrice[1].totallPriseMetal)/100,$scope.SumProfitMetal=$scope.SumProfitMetal+Math.round(100*articles[i].arrResFullPrice[1].totallProfitSaleMetal)/100;$scope.makePages=function(arr){$scope.page=[];for(var i=0;i<=arr.length-1;i++)$scope.page.push(arr[i])},$scope.makePages(articles),$scope.$watch("currentPage + numPerPage",function(){var begin=($scope.currentPage-1)*$scope.numPerPage,end=begin+$scope.numPerPage;$scope.articles=$scope.page.slice(begin,end)})})},$scope.findOne=function(){$scope.customers=Customers.query(),$scope.stores=Stores.query(),$scope.prices=Prices.query(),$scope.article=Articles.get({articleId:$stateParams.articleId})},$scope.findDiscount=function(){$scope.stores=Stores.query(),$scope.prices=Prices.query(),$scope.customers=Customers.query();var discount=document.getElementById("discount");$scope.NameCustomerCreate=document.getElementById("name-customer-create").value,$scope.customers.$promise.then(function(customers){for(var n=customers.length-1;n>=0;n--)customers[n].nameCustomer===$scope.NameCustomerCreate&&(discount.value=customers[n].discount)})},$scope.removeStoreFromArticle=function(store){store.statuss=0,store.articleIdStore="",store.sheetIdStore="",store.$update()},$scope.calculate=function(articles){var j,amountRowsArticle=$scope.countArt,tableArt=document.getElementById("table-art"),discount=document.getElementById("discount"),article=$scope.article,arrRes=[],posPrice={};for($scope.totallPriseMetalFl=0,$scope.totallPriseCutFL=0,$scope.totallProfitSaleMetalFl=0,$scope.arrResFull=[],$scope.arrResFullPrice=[],$scope.error="",j=article?article.sheet.length-1:amountRowsArticle-1;j>=0;j--){if($scope.thicknessCreate=tableArt.rows[j+1].cells[0].childNodes[1].childNodes[1].childNodes[1].value,$scope.meterCut=tableArt.rows[j+1].cells[4].childNodes[1].childNodes[1].childNodes[1].value,$scope.pierceAmount=tableArt.rows[j+1].cells[5].childNodes[1].childNodes[1].childNodes[1].value,$scope.amountSheet=tableArt.rows[j+1].cells[11].childNodes[1].childNodes[1].childNodes[1].value,$scope.formListCreate=tableArt.rows[j+1].cells[3].childNodes[1].childNodes[1].childNodes[1].childNodes[1].checked,$scope.widthListCreate=tableArt.rows[j+1].cells[1].childNodes[1].childNodes[1].childNodes[1].value,$scope.lengthListCreate=tableArt.rows[j+1].cells[2].childNodes[1].childNodes[1].childNodes[1].value,$scope.sheetCut=tableArt.rows[j+1].cells[13].childNodes[1].childNodes[1].childNodes[1].childNodes[1].checked,!$scope.thicknessCreate)throw $scope.error="Заполните хотя-бы одно поле толщины металла!",new SyntaxError("Заполните хотя-бы одно поле толщины металла!");$scope.discount=parseInt(discount.value);for(var i=$scope.prices.length-1;i>=0;i--)$scope.prices[i].thickness===parseFloat($scope.thicknessCreate)&&($scope.sheetCut?$scope.discount?$scope.price=tableArt.rows[j+1].cells[6].childNodes[1].childNodes[1].childNodes[1].value*(1-$scope.discount/100)*$scope.amountSheet:$scope.price=tableArt.rows[j+1].cells[6].childNodes[1].childNodes[1].childNodes[1].value*$scope.amountSheet:$scope.discount?$scope.price=($scope.prices[i].thicknessPrice*$scope.meterCut+$scope.pierceAmount*$scope.prices[i].thicknessPiercePrice)*(1-$scope.discount/100)*$scope.amountSheet:$scope.price=($scope.prices[i].thicknessPrice*$scope.meterCut+$scope.pierceAmount*$scope.prices[i].thicknessPiercePrice)*$scope.amountSheet);tableArt.rows[j+1].cells[6].childNodes[1].childNodes[1].childNodes[1].value=Math.round(100*$scope.price)/100,article&&(article.sheet[j].priseCut=Math.round(100*$scope.price)/100),article?article.sheet[j].formListCreate?$scope.weighMetal=tableArt.rows[j+1].cells[7].childNodes[1].childNodes[1].childNodes[1].value:article.sheet[j].widthListCreate||article.sheet[j].lengthListCreate?($scope.weighMetal=article.sheet[j].thicknessCreate*article.sheet[j].widthListCreate*article.sheet[j].lengthListCreate*7.96/1e6,tableArt.rows[j+1].cells[7].childNodes[1].childNodes[1].childNodes[1].value=$scope.weighMetal,article.sheet[j].weighMetal=$scope.weighMetal):$scope.weighMetal=tableArt.rows[j+1].cells[7].childNodes[1].childNodes[1].childNodes[1].value:$scope.formListCreate?$scope.weighMetal=tableArt.rows[j+1].cells[7].childNodes[1].childNodes[1].childNodes[1].value:$scope.widthListCreate||$scope.lengthListCreate?($scope.weighMetal=$scope.thicknessCreate*$scope.widthListCreate*$scope.lengthListCreate*7.96/1e6,tableArt.rows[j+1].cells[7].childNodes[1].childNodes[1].childNodes[1].value=$scope.weighMetal):$scope.weighMetal=tableArt.rows[j+1].cells[7].childNodes[1].childNodes[1].childNodes[1].value,$scope.priseSaleMetalKg=tableArt.rows[j+1].cells[9].childNodes[1].childNodes[1].childNodes[1].value,$scope.priseSaleMetal=$scope.weighMetal*$scope.priseSaleMetalKg*$scope.amountSheet,tableArt.rows[j+1].cells[10].childNodes[1].childNodes[1].childNodes[1].value=Math.round(100*$scope.priseSaleMetal)/100,article&&(article.sheet[j].priseSaleMetal=Math.round(100*$scope.priseSaleMetal)/100),$scope.priseStoreMetalKg=10,tableArt.rows[j+1].cells[8].childNodes[1].childNodes[1].childNodes[1].value=$scope.priseStoreMetalKg,$scope.priseSaleMetalKg?$scope.profitSaleMetal=($scope.priseSaleMetalKg-$scope.priseStoreMetalKg)*$scope.weighMetal*$scope.amountSheet:$scope.profitSaleMetal=0,posPrice={tricnes:$scope.thicknessCreate,prMetall:Math.round(100*$scope.priseSaleMetal)/100,prCut:Math.round(100*$scope.price)/100,profitSaleMetal:Math.round(100*$scope.profitSaleMetal)/100},arrRes.push(posPrice)}if(!arrRes.length)throw $scope.error="Нет данных для расчёта! Добавте хотя-бы один лист и заполните поля",new SyntaxError("Нет данных для расчёта! Добавте хотя-бы один лист и заполните поля");1===arrRes.length?$scope.arrResFull.push(posPrice):(arrRes.sort(function(a,b){return a.tricnes-b.tricnes}),arrRes.reduce(function(previous,el,index,arr){return el.tricnes===previous.tricnes?(previous.prMetall=previous.prMetall+el.prMetall,previous.prCut=previous.prCut+el.prCut,previous.profitSaleMetal=previous.profitSaleMetal+el.profitSaleMetal):($scope.arrResFull.push({tricnes:previous.tricnes,prMetall:Math.round(100*previous.prMetall)/100,prCut:Math.round(100*previous.prCut)/100,profitSaleMetal:Math.round(100*previous.profitSaleMetal)/100}),previous.prMetall=el.prMetall,previous.prCut=el.prCut,previous.tricnes=el.tricnes,previous.profitSaleMetal=el.profitSaleMetal),arr.length-1===index&&$scope.arrResFull.push({tricnes:el.tricnes,prMetall:Math.round(100*previous.prMetall)/100,prCut:Math.round(100*previous.prCut)/100,profitSaleMetal:Math.round(100*previous.profitSaleMetal)/100}),previous}));for(var n=$scope.arrResFull.length-1;n>=0;n--)$scope.totallPriseMetalFl=$scope.totallPriseMetalFl+Math.round(100*$scope.arrResFull[n].prMetall)/100,$scope.totallPriseMetal=Math.round(100*$scope.totallPriseMetalFl)/100,$scope.totallPriseCutFL=$scope.totallPriseCutFL+Math.round(100*$scope.arrResFull[n].prCut)/100,$scope.totallPriseCut=Math.round(100*$scope.totallPriseCutFL)/100,$scope.totallPrise=$scope.totallPriseMetal+$scope.totallPriseCut,$scope.totallProfitSaleMetalFl=$scope.totallProfitSaleMetalFl+Math.round(100*$scope.arrResFull[n].profitSaleMetal)/100,$scope.totallProfitSaleMetal=Math.round(100*$scope.totallProfitSaleMetalFl)/100;return $scope.arrResFullPrice.push($scope.arrResFull),$scope.arrResFullPrice.push({totallPriseMetal:$scope.totallPriseMetal,totallPriseCut:$scope.totallPriseCut,totallPrise:$scope.totallPrise,totallProfitSaleMetal:$scope.totallProfitSaleMetal}),$scope.arrResFullPrice}}]),angular.module("test").directive("addarticlefield",["$http","$compile",function($http,$compile){var tmp_add_article="modules/articles/views/add-article.html";return function(scope,element,attrs){$http.get(tmp_add_article).then(function(response){scope.countArt=0,element.bind("click",function(){scope.countArt++,angular.element(document.getElementById("add-article")).append($compile(response.data)(scope))})})}}]),angular.module("articles").factory("Articles",["$resource",function($resource){return $resource("articles/:articleId",{articleId:"@_id"},{update:{method:"PUT"}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function($scope,Authentication,Menus){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("customers").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Customers","customers","dropdown","/customers(/create)?"),Menus.addSubMenuItem("topbar","customers","List Customers","customers"),Menus.addSubMenuItem("topbar","customers","New Customer","customers/create")}]),angular.module("customers").config(["$stateProvider",function($stateProvider){$stateProvider.state("listAustomers",{url:"/customers",templateUrl:"modules/customers/views/list-customers.client.view.html"}).state("createCustomers",{url:"/customers/create",templateUrl:"modules/customers/views/create-customer.client.view.html"}).state("viewCustomers",{url:"/customers/:customerId",templateUrl:"modules/customers/views/view-customer.client.view.html"}).state("editCustomers",{url:"/customers/:customerId/edit",templateUrl:"modules/customers/views/edit-customer.client.view.html"})}]),angular.module("customers").controller("CustomersController",["$scope","$stateParams","$location","Authentication","Customers",function($scope,$stateParams,$location,Authentication,Customers){$scope.authentication=Authentication,$scope.create=function(){var customer=new Customers({nameCustomer:this.nameCustomer,content:this.content,discount:this.discount});customer.$save(function(response){$location.path("customers/"+response._id),$scope.nameCustomer="",$scope.content=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(customer){if(customer){customer.$remove();for(var i in $scope.customers)$scope.customers[i]===customer&&$scope.customers.splice(i,1)}else $scope.customer.$remove(function(){$location.path("customers")})},$scope.update=function(){var customer=$scope.customer;customer.$update(function(){$location.path("customers/"+customer._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.select="nameCustomer",$scope.NameCustomerSelectC=document.getElementById("NameCustomerSelectC").value,$scope.sortName=document.getElementById("sort-name").checked,$scope.sortDiscount=document.getElementById("sort-discount").checked,$scope.sortCreate=document.getElementById("sort-create").checked,$scope.sortName&&($scope.select="nameCustomer"),$scope.sortDiscount&&($scope.select="-discount"),$scope.sortCreate&&($scope.select="-created"),Customers.query({CustomerSelC:$scope.NameCustomerSelectC},function(customers){$scope.customers=customers})},$scope.findOne=function(){$scope.customer=Customers.get({customerId:$stateParams.customerId})}}]),angular.module("customers").factory("Customers",["$resource",function($resource){return $resource("customers/:customerId",{customerId:"@_id"},{update:{method:"PUT"}})}]),angular.module("prices").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Prices","prices","dropdown","/prices(/create)?"),Menus.addSubMenuItem("topbar","prices","List Prices","prices"),Menus.addSubMenuItem("topbar","prices","New Prices","prices/create")}]),angular.module("prices").config(["$stateProvider",function($stateProvider){$stateProvider.state("listPrices",{url:"/prices",templateUrl:"modules/prices/views/list-prices.client.view.html"}).state("createPrice",{url:"/prices/create",templateUrl:"modules/prices/views/create-price.client.view.html"}).state("viewPrice",{url:"/prices/:priceId",templateUrl:"modules/prices/views/view-price.client.view.html"}).state("editPrice",{url:"/prices/:priceId/edit",templateUrl:"modules/prices/views/edit-price.client.view.html"})}]),angular.module("prices").controller("PricesController",["$scope","$stateParams","$location","Authentication","Prices",function($scope,$stateParams,$location,Authentication,Prices){$scope.authentication=Authentication,$scope.create=function(){$scope.prices=Prices.query(),$scope.thickness=this.thickness,$scope.thicknessPrice=this.thicknessPrice,$scope.thicknessPiercePrice=this.thicknessPiercePrice,$scope.error=0,$scope.prices.$promise.then(function(prices){for(var i=prices.length-1;i>=0;i--)if($scope.prices[i].thickness===$scope.thickness)return $scope.error="Такая толщина уже существует в прайсе! В случае потребности редактируйте толщину!";if(!$scope.error){var price=new Prices({thickness:$scope.thickness,thicknessPrice:$scope.thicknessPrice,thicknessPiercePrice:$scope.thicknessPiercePrice});price.$save(function(response){$location.path("prices/"+response._id),$scope.thickness=0,$scope.thicknessPrice=0,$scope.thicknessPiercePrice=0},function(errorResponse){$scope.error=errorResponse.data.message})}})},$scope.remove=function(price){if(price){price.$remove();for(var i in $scope.prices)$scope.prices[i]===price&&$scope.prices.splice(i,1)}else $scope.price.$remove(function(){$location.path("prices")})},$scope.update=function(){var price=$scope.price;price.$update(function(){$location.path("prices/"+price._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.prices=Prices.query()},$scope.findOne=function(){$scope.price=Prices.get({priceId:$stateParams.priceId})}}]),angular.module("prices").factory("Prices",["$resource",function($resource){return $resource("prices/:priceId",{priceId:"@_id"},{update:{method:"PUT"}})}]),angular.module("stores").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Stores","stores","dropdown","/stores(/create)?"),Menus.addSubMenuItem("topbar","stores","List Stores","stores"),Menus.addSubMenuItem("topbar","stores","New Store","stores/create")}]),angular.module("stores").config(["$stateProvider",function($stateProvider){$stateProvider.state("listStores",{url:"/stores",templateUrl:"modules/stores/views/list-stores.client.view.html"}).state("createStore",{url:"/stores/create",templateUrl:"modules/stores/views/create-store.client.view.html"}).state("editStore",{url:"/stores/:storeId/edit",templateUrl:"modules/stores/views/edit-store.client.view.html"}).state("storeAddSheet",{url:"/store/article/:articleId/sheet/:sheetId/add",templateUrl:"modules/stores/views/add-article-store.client.view.html"})}]),angular.module("stores").controller("StoresController",["$scope","$stateParams","$location","Authentication","Stores","Customers","Articles",function($scope,$stateParams,$location,Authentication,Stores,Customers,Articles){$scope.authentication=Authentication,$scope.stateParams=$stateParams,$scope.create=function(){var amountRows=$scope.count;try{for(var j=amountRows;j>0;j--){var table=document.getElementById("table"),NameCustomer=document.getElementById("NameCustomer");if($scope.NameCustomer=NameCustomer.value,$scope.thickness=table.rows[j].cells[0].childNodes[1].childNodes[1].childNodes[1].value,$scope.widthList=table.rows[j].cells[1].childNodes[1].childNodes[1].childNodes[1].value,$scope.lengthList=table.rows[j].cells[2].childNodes[1].childNodes[1].childNodes[1].value,$scope.amount=table.rows[j].cells[3].childNodes[1].childNodes[1].childNodes[1].value,$scope.priseAllList=table.rows[j].cells[4].childNodes[1].childNodes[1].childNodes[1].value,$scope.weightAllList=table.rows[j].cells[5].childNodes[1].childNodes[1].childNodes[1].value,$scope.formList=table.rows[j].cells[6].childNodes[1].childNodes[1].childNodes[1].childNodes[3].checked,$scope.NameAcceptanceInspector=table.rows[j].cells[7].childNodes[1].value,$scope.sheetContent=table.rows[j].cells[8].childNodes[1].childNodes[1].childNodes[1].value,"цех"===$scope.NameCustomer?$scope.weightList=Math.round($scope.weightAllList/$scope.amount*100)/100:$scope.formList?$scope.weightList=0:$scope.weightList=Math.round($scope.thickness*$scope.widthList*$scope.lengthList*7.9/1e4)/100,$scope.priseKg=Math.round($scope.priseAllList/$scope.weightAllList*100)/100,$scope.priseOfList=Math.round($scope.priseAllList/$scope.amount*100)/100,!$scope.thickness)throw $scope.error="Укажите толщину",new SyntaxError("Укажите толщину");if(!$scope.widthList)throw $scope.error="Укажите ширину",new SyntaxError("Укажите ширину");if(!$scope.lengthList)throw $scope.error="Укажите длинну",new SyntaxError("Укажите длинну");if($scope.NameCustomer){if(!("цех"!==$scope.NameCustomer||$scope.priseAllList&&$scope.weightAllList))throw $scope.error="Если лиcты принимаются на цех, укажите цену всех листов и вес всех листов из накладной",new SyntaxError("Если лиcты принимаются на цех, укажите цену всех листов и вес всех листов из накладной");if(!$scope.amount)throw $scope.error="Укажите колличество листов",new SyntaxError("Укажите колличество листов");for(var i=$scope.amount-1;i>=0;i--){var store=new Stores({NameAcceptanceInspector:$scope.NameAcceptanceInspector,NameCustomer:$scope.NameCustomer,thickness:$scope.thickness,widthList:$scope.widthList,lengthList:$scope.lengthList,amount:$scope.amount,weightList:$scope.weightList,priseOfList:$scope.priseOfList,priseKg:$scope.priseKg,formList:$scope.formList,sheetContent:$scope.sheetContent});store.$save(function(response){$location.path("/stores"),$scope.NameAcceptanceInspector="",$scope.NameCustomer="",$scope.thickness=0,$scope.widthList=0,$scope.lengthList=0,$scope.amount=0,$scope.priseAllList=0,$scope.formList=!1,$scope.sheetContent=""},function(errorResponse){$scope.error=errorResponse.data.message})}}else $scope.error="Укажите имя клиента"}}catch(error){console.log(error)}},$scope.remove=function(store){if(store){store.$remove();for(var i in $scope.stores)$scope.stores[i]===store&&$scope.stores.splice(i,1)}else $scope.store.$remove(function(){$location.path("stores")})},$scope.update=function(){var calculateWeightList,store=$scope.store;$scope.formList=document.getElementById("form-list").checked,$scope.thickness=document.getElementById("thickness").value,$scope.widthList=document.getElementById("widthList").value,$scope.lengthList=document.getElementById("lengthList").value,$scope.NameCustomer=document.getElementById("NameCustomer").value,calculateWeightList=Math.round($scope.thickness*$scope.widthList*$scope.lengthList*7.86/1e6*100)/100,$scope.formList||"цех"===$scope.NameCustomer||(store.weightList=calculateWeightList),"цех"===$scope.NameCustomer&&($scope.initFormList&&!$scope.formList&&(store.weightList=calculateWeightList),$scope.thickness!==$scope.initThickness||$scope.widthList!==$scope.initWidthList||$scope.lengthList!==$scope.initLengthList?$scope.formList||(store.weightList=calculateWeightList):$scope.formList&&(store.weightList=document.getElementById("weightList").value)),store.priseOfList=Math.round(store.weightList*store.priseKg),store.$update(function(){$location.path("stores")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.NameCustomerSelect=document.getElementById("NameCustomerSelect").value,$scope.thicknesSel=parseFloat(document.getElementById("thicknesSel").value),$scope.widthSel=parseInt(document.getElementById("widthSel").value),$scope.lengthSel=parseInt(document.getElementById("lengthSel").value),$scope.beforeDate=document.getElementById("before-date").value,$scope.afterDate=document.getElementById("after-date").value,$scope.select="-created",$scope.sortName=document.getElementById("sort-name").checked,$scope.sortCreated=document.getElementById("sort-created").checked,$scope.sortPriseKg=document.getElementById("sort-sortPriseKg").checked,$scope.thickness=document.getElementById("sort-thickness").checked,$scope.widthList=document.getElementById("sort-widthList").checked,$scope.lengthList=document.getElementById("sort-lengthList").checked,$scope.sortName&&($scope.select="NameCustomer"),$scope.sortCreated&&($scope.select="-created"),$scope.sortPriseKg&&($scope.select="-priseKg"),$scope.thickness&&($scope.select="thickness"),$scope.widthList&&($scope.select="-widthList"),$scope.lengthList&&($scope.select="-lengthList"),$scope.stores=Stores.query({CustomerSel:$scope.NameCustomerSelect,CustomerTr:$scope.thicknesSel,CustomerW:$scope.widthSel,CustomerL:$scope.lengthSel,CustomerBeforeDate:$scope.beforeDate,CustomerAfterDate:$scope.afterDate}),$scope.customers=Customers.query(),$scope.SumOwnMetalWeight=0,$scope.SumOwnPriceMetal=0,$scope.stores.$promise.then(function(stores){for(var i=stores.length-1;i>=0;i--)"цех"===stores[i].NameCustomer&&($scope.SumOwnMetalWeight=$scope.SumOwnMetalWeight+Math.round(100*stores[i].weightList)/100,$scope.SumOwnPriceMetal=$scope.SumOwnPriceMetal+Math.round(100*stores[i].priseOfList)/100)})},$scope.findOne=function(){$scope.store=Stores.get({storeId:$stateParams.storeId}),$scope.customers=Customers.query(),angular.element(document).ready(function(){$scope.initThickness=document.getElementById("thickness").value,$scope.initWidthList=document.getElementById("widthList").value,$scope.initLengthList=document.getElementById("lengthList").value,$scope.initFormList=document.getElementById("form-list").checked})},$scope.findCustomer=function(){$scope.customers=Customers.query()},$scope.AddSheetToArticle=function(){var stores=$scope.stores;for(var i in stores)1==stores[i].addstatus&&(stores[i].statuss=1,stores[i].$update(function(){window.history.back()},function(errorResponse){
$scope.error=errorResponse.data.message}))}}]),angular.module("stores").filter("convertSheetStatus",function(){return function(item){switch(item=item.toString()){case"0":item="свободен";break;case"1":item="в роботе";break;default:item=""}return item}}),angular.module("test").directive("addlist",["$http","$compile",function($http,$compile){var tmp_add_list="modules/stores/views/add-list.html";return function(scope,element,attrs){$http.get(tmp_add_list).then(function(response){scope.count=0,element.bind("click",function(){scope.count++,angular.element(document.getElementById("add-list")).append($compile(response.data)(scope))})})}}]),angular.module("stores").factory("Stores",["$resource",function($resource){return $resource("stores/:storeId",{storeId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);